<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EquipGPT Dashboard - PDF Processing Suite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    
    /* Sidebar Navigation */
    .sidebar {
      width: 260px;
      height: 100vh;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      position: fixed;
      left: 0;
      top: 0;
      padding: 24px 0;
      box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      transition: transform 0.3s ease;
    }
    
    .logo {
      padding: 0 24px 32px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
      margin-bottom: 24px;
    }
    
    .logo h1 {
      font-size: 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
    }
    
    .logo p {
      font-size: 12px;
      color: #6b7280;
      margin-top: 4px;
    }
    
    .nav-items {
      padding: 0 16px;
    }
    
    .nav-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      margin-bottom: 8px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      color: #374151;
      text-decoration: none;
      background: transparent;
      border: none;
      width: 100%;
      text-align: left;
      font-size: 14px;
      font-weight: 500;
    }
    
    .nav-item:hover {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
    }
    
    .nav-item.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .nav-item svg {
      width: 20px;
      height: 20px;
      margin-right: 12px;
      flex-shrink: 0;
    }
    
    /* Main Content Area */
    .main-content {
      margin-left: 260px;
      padding: 32px;
      min-height: 100vh;
    }
    
    .page {
      display: none;
      animation: fadeIn 0.4s ease;
    }
    
    .page.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Dashboard Stats */
    .dashboard-header {
      margin-bottom: 32px;
    }
    
    .dashboard-header h2 {
      font-size: 32px;
      color: white;
      margin-bottom: 8px;
      font-weight: 700;
    }
    
    .dashboard-header p {
      color: rgba(255, 255, 255, 0.8);
      font-size: 16px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }
    
    .stat-card {
      background: white;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.12);
    }
    
    .stat-label {
      font-size: 12px;
      text-transform: uppercase;
      color: #6b7280;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .stat-value {
      font-size: 36px;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .stat-change {
      font-size: 13px;
      color: #10b981;
      margin-top: 8px;
      display: flex;
      align-items: center;
    }
    
    /* Upload Sections */
    .upload-container {
      background: white;
      border-radius: 20px;
      padding: 32px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
    }
    
    .upload-header {
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f3f4f6;
    }
    
    .upload-header h3 {
      font-size: 24px;
      color: #1f2937;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .upload-header p {
      color: #6b7280;
      font-size: 14px;
    }
    
    .upload-area {
      border: 2px dashed #e5e7eb;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      margin-bottom: 24px;
      transition: all 0.3s;
      background: #fafbfc;
    }
    
    .upload-area:hover {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.02);
    }
    
    .upload-area.dragging {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.05);
    }
    
    .upload-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 16px;
      opacity: 0.4;
    }
    
    .file-input {
      display: none;
    }
    
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 24px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }
    
    .btn-secondary:hover {
      background: #e5e7eb;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    /* Results Section */
    .results-section {
      margin-top: 32px;
      display: none;
    }
    
    .results-section.active {
      display: block;
    }
    
    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .result-stats {
      display: flex;
      gap: 24px;
    }
    
    .result-stat {
      display: flex;
      flex-direction: column;
    }
    
    .result-stat span:first-child {
      font-size: 12px;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .result-stat span:last-child {
      font-size: 24px;
      font-weight: 700;
      color: #1f2937;
    }
    
    /* Table Styles */
    .table-container {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
    }
    
    .equipment-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .equipment-table th {
      background: #f9fafb;
      padding: 12px;
      text-align: left;
      font-size: 12px;
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .equipment-table td {
      padding: 12px;
      border-bottom: 1px solid #f3f4f6;
      font-size: 14px;
      color: #374151;
    }
    
    .equipment-table td[contenteditable="true"] {
      cursor: text;
      transition: background 0.2s;
    }
    
    .equipment-table td[contenteditable="true"]:hover {
      background: #f9fafb;
    }
    
    .equipment-table td[contenteditable="true"]:focus {
      outline: 2px solid #667eea;
      outline-offset: -1px;
      background: rgba(102, 126, 234, 0.05);
    }
    
    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-top: 24px;
      padding: 20px;
      background: #f9fafb;
      border-radius: 0 0 12px 12px;
    }
    
    .pagination button {
      padding: 8px 16px;
      border-radius: 8px;
      background: white;
      border: 1px solid #e5e7eb;
      color: #374151;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .pagination button:hover:not(:disabled) {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }
    
    .pagination button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .page-info {
      font-size: 14px;
      color: #6b7280;
      padding: 0 12px;
    }
    
    /* Loading Spinner */
    .loader {
      display: none;
      justify-content: center;
      align-items: center;
      padding: 32px;
    }
    
    .loader.active {
      display: flex;
    }
    
    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #e5e7eb;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Status Messages */
    .status-message {
      padding: 12px 16px;
      border-radius: 8px;
      margin-top: 16px;
      font-size: 14px;
      display: none;
    }
    
    .status-message.success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #a7f3d0;
      display: block;
    }
    
    .status-message.error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fecaca;
      display: block;
    }
    
    /* Recent Activity */
    .activity-list {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-top: 24px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
    }
    
    .activity-header {
      font-size: 18px;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 20px;
    }
    
    .activity-item {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #f3f4f6;
    }
    
    .activity-item:last-child {
      border-bottom: none;
    }
    
    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 16px;
    }
    
    .activity-details {
      flex: 1;
    }
    
    .activity-title {
      font-size: 14px;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 4px;
    }
    
    .activity-time {
      font-size: 12px;
      color: #6b7280;
    }

    
    /* Strategies Page Styles */
    .strategies-container {
      background: white;
      border-radius: 20px;
      padding: 32px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
    }
    
    .strategies-header {
      margin-bottom: 32px;
      padding-bottom: 24px;
      border-bottom: 2px solid #f3f4f6;
    }
    
    .strategies-header h3 {
      font-size: 28px;
      color: #1f2937;
      margin-bottom: 12px;
      font-weight: 700;
    }
    
    .strategies-header p {
      color: #6b7280;
      font-size: 15px;
      line-height: 1.6;
    }
    
    .strategy-card {
      background: #fafbfc;
      border-radius: 16px;
      padding: 28px;
      margin-bottom: 24px;
      border: 1px solid #e5e7eb;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .strategy-card:hover {
      transform: translateX(8px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      border-color: #667eea;
    }
    
    .strategy-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .strategy-card:hover::before {
      opacity: 1;
    }
    
    .strategy-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: 700;
      border-radius: 10px;
      margin-bottom: 16px;
      font-size: 16px;
    }
    
    .strategy-title {
      font-size: 20px;
      color: #1f2937;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .strategy-description {
      color: #4b5563;
      font-size: 14px;
      line-height: 1.7;
      margin-bottom: 20px;
    }
    
    .limitation-box {
      background: #fff;
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      position: relative;
    }
    
    .limitation-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .limitation-icon {
      width: 24px;
      height: 24px;
      background: #fee2e2;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .limitation-icon svg {
      width: 14px;
      height: 14px;
      fill: #dc2626;
    }
    
    .limitation-title {
      font-size: 14px;
      color: #dc2626;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .limitation-content {
      color: #374151;
      font-size: 14px;
      line-height: 1.6;
      padding-left: 32px;
    }
    
    .tag {
      display: inline-block;
      padding: 4px 10px;
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 8px;
      margin-bottom: 8px;
    }
    
    .tag.critical {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }
    
    .tag.warning {
      background: rgba(245, 158, 11, 0.1);
      color: #f59e0b;
    }
    
    /* Mobile Responsiveness */
    .menu-toggle {
      display: none;
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1100;
      background: white;
      border: none;
      border-radius: 8px;
      padding: 8px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    @media (max-width: 768px) {
      .menu-toggle {
        display: block;
      }
      
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.open {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
        padding: 20px;
        padding-top: 60px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .strategy-card {
        padding: 20px;
      }
      
      .limitation-content {
        padding-left: 0;
        margin-top: 8px;
      }      
    }
  </style>
</head>
<body>
  <!-- Mobile Menu Toggle -->
  <button class="menu-toggle" onclick="toggleSidebar()">
    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M3 12h18M3 6h18M3 18h18"/>
    </svg>
  </button>

  <!-- Sidebar Navigation -->
  <nav class="sidebar" id="sidebar">
    <div class="logo">
      <h1>EquipGPT</h1>
      <p>PDF Processing Suite</p>
    </div>
    <div class="nav-items">
      <button class="nav-item active" onclick="showPage('dashboard', this)">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
        </svg>
        Dashboard
      </button>
      <button class="nav-item" onclick="showPage('medium-voltage', this)">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        Medium Voltage
      </button>
      <button class="nav-item" onclick="showPage('equipment-data', this)">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
        </svg>
        Equipment Data
      </button>
      <button class="nav-item" onclick="showPage('strategies')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        Strategies & Limitations
      </button>
    </div>
  </nav>

  <!-- Main Content Area -->
  <main class="main-content">
    <!-- Dashboard Page -->
    <div id="dashboard" class="page active">
      <div class="dashboard-header">
        <h2>Welcome to EquipGPT Dashboard</h2>
        <p>Process and analyze your electrical equipment PDFs with ease</p>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total PDFs Processed</div>
          <div class="stat-value">247</div>
          <div class="stat-change">
            <svg width="16" height="16" fill="#10b981">
              <path d="M8 4l4 8H4z"/>
            </svg>
            +12% from last month
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Equipment Extracted</div>
          <div class="stat-value">1,842</div>
          <div class="stat-change">
            <svg width="16" height="16" fill="#10b981">
              <path d="M8 4l4 8H4z"/>
            </svg>
            +23% from last month
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">MVS Count</div>
          <div class="stat-value">523</div>
          <div class="stat-change">
            <svg width="16" height="16" fill="#10b981">
              <path d="M8 4l4 8H4z"/>
            </svg>
            +8% from last month
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">DSG Count</div>
          <div class="stat-value">189</div>
          <div class="stat-change">
            <svg width="16" height="16" fill="#10b981">
              <path d="M8 4l4 8H4z"/>
            </svg>
            +15% from last month
          </div>
        </div>
      </div>

      <div class="activity-list">
        <h3 class="activity-header">Recent Activity</h3>
        <div class="activity-item">
          <div class="activity-icon">
            <svg width="20" height="20" fill="white">
              <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
              <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 1 1 0 000 2H6a2 2 0 00-2 2v6a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2a1 1 0 100-2h2a4 4 0 014 4v8a4 4 0 01-4 4H6a4 4 0 01-4-4V7z"/>
            </svg>
          </div>
          <div class="activity-details">
            <div class="activity-title">Medium Voltage PDF Processed</div>
            <div class="activity-time">2 minutes ago</div>
          </div>
        </div>
        <div class="activity-item">
          <div class="activity-icon">
            <svg width="20" height="20" fill="white">
              <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
              <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 1 1 0 000 2H6a2 2 0 00-2 2v6a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2a1 1 0 100-2h2a4 4 0 014 4v8a4 4 0 01-4 4H6a4 4 0 01-4-4V7z"/>
            </svg>
          </div>
          <div class="activity-details">
            <div class="activity-title">Equipment Data Extracted</div>
            <div class="activity-time">15 minutes ago</div>
          </div>
        </div>
        <div class="activity-item">
          <div class="activity-icon">
            <svg width="20" height="20" fill="white">
              <path d="M10 2a8 8 0 100 16 8 8 0 000-16zM8 7a1 1 0 012 0v5a1 1 0 11-2 0V7zm4 0a1 1 0 012 0v5a1 1 0 11-2 0V7z"/>
            </svg>
          </div>
          <div class="activity-details">
            <div class="activity-title">Excel Report Generated</div>
            <div class="activity-time">1 hour ago</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Medium Voltage Page -->
    <div id="medium-voltage" class="page">
      <div class="upload-container">
        <div class="upload-header">
          <h3>Medium Voltage PDF Processor</h3>
          <p>Upload your medium voltage PDF to extract equipment and connection mapping</p>
        </div>

        <form id="mvForm">
          <div class="upload-area" id="mvUploadArea">
            <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
            <p style="font-size: 16px; color: #374151; margin-bottom: 8px;">Drop your PDF here or click to browse</p>
            <p style="font-size: 13px; color: #6b7280;">Maximum file size: 50MB</p>
            <input type="file" id="mvInput" class="file-input" accept="application/pdf" />
            <label for="mvInput" class="btn" style="margin-top: 16px;">Choose File</label>
          </div>

          <div id="mvFileName" style="display:none; margin-bottom: 16px; padding: 12px; background: #f3f4f6; border-radius: 8px; font-size: 14px;"></div>
          
          <button type="submit" class="btn" id="mvSubmit" disabled>
            <svg width="16" height="16" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Process PDF
          </button>

          <div class="loader" id="mvLoader">
            <div class="spinner"></div>
          </div>

          <div id="mvStatus" class="status-message"></div>
        </form>

        <div id="mvResults" class="results-section">
          <div class="result-header">
            <div class="result-stats">
              <div class="result-stat">
                <span></span>
                <span id="mvMvsCount"></span>
              </div>
              <div class="result-stat">
                <span></span>
                <span id="mvDsgCount"></span>
              </div>
            </div>
            <button class="btn" onclick="downloadMvExcel()">
              Download Excel
            </button>
          </div>
          <div id="mvTableContainer"></div>
        </div>
      </div>
    </div>

    <!-- Equipment Data Page -->
    <div id="equipment-data" class="page">
      <div class="upload-container">
        <div class="upload-header">
          <h3>Equipment Data Extractor</h3>
          <p>Upload your equipment PDF for detailed data extraction and analysis</p>
        </div>

        <form id="edForm">
          <div class="upload-area" id="edUploadArea">
            <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
            <p style="font-size: 16px; color: #374151; margin-bottom: 8px;">Drop your PDF here or click to browse</p>
            <p style="font-size: 13px; color: #6b7280;">Maximum file size: 50MB</p>
            <input type="file" id="edInput" class="file-input" accept="application/pdf" />
            <label for="edInput" class="btn" style="margin-top: 16px;">Choose File</label>
          </div>

          <div id="edFileName" style="display:none; margin-bottom: 16px; padding: 12px; background: #f3f4f6; border-radius: 8px; font-size: 14px;"></div>
          
          <button type="submit" class="btn" id="edSubmit" disabled>
            <svg width="16" height="16" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Process PDF
          </button>

          <div class="loader" id="edLoader">
            <div class="spinner"></div>
          </div>

          <div id="edStatus" class="status-message"></div>
        </form>

        <div id="edResults" class="results-section">
          <div class="result-header">
            <div class="result-stats">
              <div class="result-stat">
                <span>Equipment Count</span>
                <span id="edEquipmentCount">0</span>
              </div>
              <div class="result-stat">
                <span>Types Identified</span>
                <span id="edTypesCount">0</span>
              </div>
            </div>
            <button class="btn" onclick="downloadEdExcel()">
              Download Excel
            </button>
          </div>
          <div id="edTableContainer"></div>
        </div>
      </div>
    </div>
    
    <!-- Strategies & Limitations Page -->
    <div id="strategies" class="page">
      <div class="strategies-container">
        <div class="strategies-header">
          <h3>PDF Extraction Strategies & Their Limitations</h3>
          <p>Understanding different approaches to PDF data extraction and why they face challenges with complex electrical diagrams</p>
        </div>

        <!-- Strategy 1 -->
        <div class="strategy-card">
          <div class="strategy-number">1</div>
          <div class="strategy-title">
            Pure Text-Based Extraction
            <span class="tag">Fast</span>
            <span class="tag">Simple</span>
            <span class="tag">Stable</span>
          </div>
          <div class="strategy-description">
            This strategy leverages only the PDF text layer. It reads all text using a PDF library, identifies equipment names using regular expressions (regex), and analyzes nearby lines of text to extract properties such as voltage (V), amperage (A), power (kW), and connection type (Y/V). 
            <br><br>
            The Primary From and Alternate From connections are inferred based on text proximity—essentially determining "who is closest in the text order"—combined with naming conventions. For example, it looks for the nearest MVS to a DSG or explicit phrases like "FED FROM". 
            <br><br>
            While this approach is fast, simple to implement, and highly stable since it ignores graphics entirely, it can only guess the network structure from text proximity rather than understanding the actual physical wiring shown on the page.
          </div>
          
          <div class="limitation-box">
            <div class="limitation-header">
              <div class="limitation-icon">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                </svg>
              </div>
              <span class="limitation-title">Why This Fails on Complex Diagrams</span>
            </div>
            <div class="limitation-content">
              On your diagrams, this approach fails because equipment pieces are arranged in long parallel rows with very similar names and extremely dense text. The "nearest text in reading order" doesn't match the actual feeder that is physically connected. The same upstream device can appear close in text to several different downstream loads, causing the script to consistently assign the wrong Primary and Alternate sources.
            </div>
          </div>
        </div>

        <!-- Strategy 2 -->
        <div class="strategy-card">
          <div class="strategy-number">2</div>
          <div class="strategy-title">
            Heavy OCR + Computer Vision Pipeline
            <span class="tag">Accurate</span>
            <span class="tag warning">Resource Heavy</span>
            <span class="tag critical">Complex</span>
          </div>
          <div class="strategy-description">
            This approach renders each PDF page to an image and processes it like a photograph. Image processing algorithms clean the page, detect boxes, lines, and shapes, then OCR (Optical Character Recognition) reads text from the detected regions.
            <br><br>
            The system attempts to visually detect equipment blocks, identify wires as line segments, and use geometry to understand connections. Once the physical structure is reconstructed, it maps each box to an equipment tag and uses wire directions to define Primary From and Alternate From relationships.
            <br><br>
            While this can theoretically be very accurate on messy PDFs with poor text layers, it's computationally expensive, more fragile to noise, and significantly harder to maintain.
          </div>
          
          <div class="limitation-box">
            <div class="limitation-header">
              <div class="limitation-icon">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                </svg>
              </div>
              <span class="limitation-title">Why This Fails on Complex Diagrams</span>
            </div>
            <div class="limitation-content">
              On your diagrams, most feeders and ties are drawn with dashed or segmented lines that are extremely thin at normal zoom levels. The computer vision stage detects them as many tiny broken segments with random gaps, and often merges crossing feeders into a single line. This results in the system building an incorrect or fragmented network and cannot reliably determine which upstream device is the true primary or alternate source.
            </div>
          </div>
        </div>

        <!-- Strategy 3 -->
        <div class="strategy-card">
          <div class="strategy-number">3</div>
          <div class="strategy-title">
            Full Topology Graph from Image Content
            <span class="tag">Graph-Based</span>
            <span class="tag">Directional</span>
            <span class="tag warning">Sensitive</span>
          </div>
          <div class="strategy-description">
            This sophisticated strategy treats the entire diagram as a mathematical graph structure. It first detects lines, junctions, and arrowheads in the image. Every junction becomes a node in the graph and every wire segment becomes an edge connecting nodes.
            <br><br>
            Arrowheads indicate the direction of power flow, creating a directed graph. Equipment text is "snapped" to nearby nodes, anchoring each piece of equipment to specific locations in the network. Once the graph is constructed, the algorithm walks upstream from each equipment node to find power sources—these paths define the Primary From and Alternate From relationships.
            <br><br>
            This approach is much closer to how an engineer reads a one-line diagram, but it heavily depends on accurate line and arrow detection and can be extremely sensitive to drawing quirks.
          </div>
          
          <div class="limitation-box">
            <div class="limitation-header">
              <div class="limitation-icon">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                </svg>
              </div>
              <span class="limitation-title">Why This Fails on Complex Diagrams</span>
            </div>
            <div class="limitation-content">
              The dashed lines and frequent crossings in your diagrams create hundreds of false junctions and broken paths. Many arrows are small or blend into other symbols when rasterized. The graph traversal algorithm then follows wrong branches, identifies alternate paths that don't actually exist, or completely loses the separation between primary and alternate feeders.
            </div>
          </div>
        </div>

        <!-- Strategy 4 -->
        <div class="strategy-card">
          <div class="strategy-number">4</div>
          <div class="strategy-title">
            Topology Graph from Vector Drawing Objects
            <span class="tag">Vector-Based</span>
            <span class="tag">Fast</span>
            <span class="tag">Clean</span>
          </div>
          <div class="strategy-description">
            Instead of converting pages to images, this strategy directly examines the PDF's vector drawing commands. It collects all lines, polylines, and polygons, transforms them into segments and junctions, then builds the same kind of node-edge graph without requiring any OCR.
            <br><br>
            Equipment names still come from the text layer, with each text object snapped to the nearest graph node. The algorithm then traverses the graph to identify upstream branches and determine which nodes represent Primary From and which are Alternates.
            <br><br>
            This approach is typically faster and cleaner than image-based computer vision because it works with the original vector geometry that created the diagram. However, it assumes those vectors form clean, continuous wires.
          </div>
          
          <div class="limitation-box">
            <div class="limitation-header">
              <div class="limitation-icon">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                </svg>
              </div>
              <span class="limitation-title">Why This Fails on Complex Diagrams</span>
            </div>
            <div class="limitation-content">
              In your diagrams, the vector data for many feeders is stored as chains of short dashes that don't actually touch at the ends. Where feeders cross on a bus, they overlap exactly at the same coordinates. The graph builder ends up with either disconnected pieces that don't form a complete path, or single "super nodes" where several independent feeders appear to be one large junction. This prevents the system from separating or correctly labeling the primary and alternate paths.
            </div>
          </div>
        </div>

        <!-- Strategy 5 -->
        <div class="strategy-card">
          <div class="strategy-number">5</div>
          <div class="strategy-title">
            LLM Vision-Driven Graph Extraction
            <span class="tag">AI-Powered</span>
            <span class="tag">Flexible</span>
            <span class="tag critical">Costly</span>
          </div>
          <div class="strategy-description">
            This cutting-edge approach outsources the "vision and reasoning" to a multimodal Large Language Model (LLM). The system renders the page to an image, extracts raw text blocks, and sends both along with a detailed prompt to the model.
            <br><br>
            The prompt carefully describes what constitutes equipment, what constitutes a connection, and specifies the expected output format (typically a JSON list of nodes and edges with equipment types and directions). The model returns a structured graph that is then post-processed to determine Primary From, Alternate From, and final label lines.
            <br><br>
            This strategy offers exceptional flexibility and can handle unusual drawings or mixed annotations. However, it introduces API costs and latency, and its accuracy depends heavily on prompt design and the model's visual understanding capabilities.
          </div>
          
          <div class="limitation-box">
            <div class="limitation-header">
              <div class="limitation-icon">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                </svg>
              </div>
              <span class="limitation-title">Why This Fails on Complex Diagrams</span>
            </div>
            <div class="limitation-content">
              Your diagrams are extremely dense with information. The dashed and overlapping feeders look very similar at the resolution that the model can reasonably process. The primary or alternate relationship is often defined by subtle symbols and operating notes rather than simple, single arrows. While the model can usually read equipment tags and properties, it frequently misinterprets which dashed line belongs to which equipment and confuses tie arrangements. The extracted primary and alternate feeds are not consistent or reliable enough for production use.
            </div>
          </div>
        </div>
      </div>
    </div>    
  </main>

  <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
  <script>
    // ===== Backend base URL =====
    // Default: same origin (when served by FastAPI).
    // Optional override: add ?api=https://YOUR-RENDER-APP.onrender.com
    const API_BASE = new URLSearchParams(window.location.search).get("api") || window.location.origin;

    // Map pages -> backend endpoints
    // - Medium Voltage page => Type 2 extractor
    // - Equipment Data page => Type 1 extractor
    const ENDPOINTS = {
      mv: "/extract-type1",   // Medium Voltage -> Type 1
      ed: "/extract-type2",   // Equipment Data -> Type 2
      exportEdited: "/export-edited",
      outputsPrefix: "/outputs/"
    };


    // Global variables for storing data (kept same names)
    let mvData = null; // { which, equipment_data, excel_file_name, execution_time_seconds, rowsRef }
    let edData = null;

    // Navigation (unchanged UI)
    function showPage(pageId, el) {
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      if (el) el.classList.add('active');

      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');

      if (window.innerWidth <= 768) document.getElementById('sidebar').classList.remove('open');
    }


    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }

    document.addEventListener('click', (e) => {
      const sidebar = document.getElementById('sidebar');
      const menuToggle = document.querySelector('.menu-toggle');
      if (window.innerWidth <= 768 && !sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
        sidebar.classList.remove('open');
      }
    });

    // Helpers
    function absUrl(path) {
      return new URL(path, API_BASE).toString();
    }

    function safeText(v) {
      return (v === undefined || v === null) ? "" : String(v);
    }

    function headersFor(which) {
      // Must match backend export-edited expectations
      return which === "type1"
        ? ["Equipment", "Type", "Properties", "Primary From", "Alternate From"]
        : ["Equipment", "Type", "Properties", "Alternate From", "Primary From"];
    }

    function setStatus(el, type, msgHtml) {
      el.className = 'status-message ' + (type || '');
      el.innerHTML = msgHtml || '';
      if (!msgHtml) {
        el.className = 'status-message';
      }
    }

    // Drag and drop functionality (unchanged)
    function setupDragDrop(uploadArea, fileInput) {
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, preventDefaults, false);
      });

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ['dragenter', 'dragover'].forEach(eventName => {
        uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragging'));
      });

      ['dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragging'));
      });

      uploadArea.addEventListener('drop', (e) => {
        const files = e.dataTransfer.files;
        if (files.length > 0 && files[0].type === 'application/pdf') {
          fileInput.files = files;
          fileInput.dispatchEvent(new Event('change'));
        }
      });
    }

    // ===== Medium Voltage (Type 2) =====
    const mvInput = document.getElementById('mvInput');
    const mvUploadArea = document.getElementById('mvUploadArea');
    const mvFileName = document.getElementById('mvFileName');
    const mvSubmit = document.getElementById('mvSubmit');
    const mvForm = document.getElementById('mvForm');
    const mvLoader = document.getElementById('mvLoader');
    const mvStatus = document.getElementById('mvStatus');
    const mvResults = document.getElementById('mvResults');

    setupDragDrop(mvUploadArea, mvInput);

    mvInput.addEventListener('change', () => {
      const file = mvInput.files[0];
      if (file) {
        mvFileName.style.display = 'block';
        mvFileName.innerHTML = `<strong>Selected:</strong> ${file.name} (${(file.size / (1024 * 1024)).toFixed(2)} MB)`;
        mvSubmit.disabled = false;
      }
    });

    mvForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const file = mvInput.files[0];
      if (!file) return;

      mvLoader.classList.add('active');
      setStatus(mvStatus, '', '');
      mvSubmit.disabled = true;
      mvResults.classList.remove('active');

      try {
        const formData = new FormData();
        // Backend expects pdf_file
        formData.append('pdf_file', file);

        const response = await fetch(absUrl(ENDPOINTS.mv), { method: 'POST', body: formData });

        if (!response.ok) {
          const text = await response.text();
          throw new Error(`Server error: ${response.status}
${text || ''}`);
        }

        const data = await response.json();

        mvData = {
          which: "type1",
          raw: data,
          equipment_data: Array.isArray(data.equipment_data) ? data.equipment_data : [],
          excel_file_name: data.excel_file_name || null,
          execution_time_seconds: data.execution_time_seconds ?? null,
        };

        displayMvResults(mvData);

        const dl = mvData.excel_file_name
          ? `<br/><a href="${absUrl(ENDPOINTS.outputsPrefix + mvData.excel_file_name)}" target="_blank" rel="noopener noreferrer">Download original Excel</a>`
          : "";

        setStatus(mvStatus, 'success', `PDF processed successfully!${dl}`);

      } catch (error) {
        setStatus(mvStatus, 'error', `Error: ${safeText(error.message)}`);
      } finally {
        mvLoader.classList.remove('active');
        mvSubmit.disabled = false;
      }
    });

    function displayMvResults(state) {
      // We don't have mvs/dsg counts from type2 backend; set to 0 (keeps UI)
      // document.getElementById('mvMvsCount').textContent = 0;
      // document.getElementById('mvDsgCount').textContent = 0;

      const rows = state.equipment_data || [];
      if (rows.length > 0) {
        mvResults.classList.add('active');
        renderTable(rows, 'mvTableContainer', 'mv', state.which);
      }
    }

    // ===== Equipment Data (Type 1) =====
    const edInput = document.getElementById('edInput');
    const edUploadArea = document.getElementById('edUploadArea');
    const edFileName = document.getElementById('edFileName');
    const edSubmit = document.getElementById('edSubmit');
    const edForm = document.getElementById('edForm');
    const edLoader = document.getElementById('edLoader');
    const edStatus = document.getElementById('edStatus');
    const edResults = document.getElementById('edResults');

    setupDragDrop(edUploadArea, edInput);

    edInput.addEventListener('change', () => {
      const file = edInput.files[0];
      if (file) {
        edFileName.style.display = 'block';
        edFileName.innerHTML = `<strong>Selected:</strong> ${file.name} (${(file.size / (1024 * 1024)).toFixed(2)} MB)`;
        edSubmit.disabled = false;
      }
    });

    edForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const file = edInput.files[0];
      if (!file) return;

      edLoader.classList.add('active');
      setStatus(edStatus, '', '');
      edSubmit.disabled = true;
      edResults.classList.remove('active');

      try {
        const formData = new FormData();
        formData.append('pdf_file', file);

        const response = await fetch(absUrl(ENDPOINTS.ed), { method: 'POST', body: formData });

        if (!response.ok) {
          const text = await response.text();
          throw new Error(`Server error: ${response.status}
${text || ''}`);
        }

        const data = await response.json();

        edData = {
          which: "type2",
          raw: data,
          equipment_data: Array.isArray(data.equipment_data) ? data.equipment_data : [],
          excel_file_name: data.excel_file_name || null,
          execution_time_seconds: data.execution_time_seconds ?? null,
        };

        displayEdResults(edData);

        const dl = edData.excel_file_name
          ? `<br/><a href="${absUrl(ENDPOINTS.outputsPrefix + edData.excel_file_name)}" target="_blank" rel="noopener noreferrer">Download original Excel</a>`
          : "";

        setStatus(edStatus, 'success', `PDF processed successfully!${dl}`);

      } catch (error) {
        setStatus(edStatus, 'error', `Error: ${safeText(error.message)}`);
      } finally {
        edLoader.classList.remove('active');
        edSubmit.disabled = false;
      }
    });

    function displayEdResults(state) {
      const rows = state.equipment_data || [];
      document.getElementById('edEquipmentCount').textContent = rows.length;

      // Count unique types (works with both)
      const types = new Set(rows.map(item => item.Type).filter(Boolean));
      document.getElementById('edTypesCount').textContent = types.size;

      if (rows.length > 0) {
        edResults.classList.add('active');
        renderTable(rows, 'edTableContainer', 'ed', state.which);
      }
    }

    // ===== Table rendering with pagination (UI intact) =====
    function renderTable(data, containerId, prefix, which) {
      const container = document.getElementById(containerId);
      const pageSize = 20;
      const totalPages = Math.max(1, Math.ceil(data.length / pageSize));
      let currentPage = 1;

      const headers = headersFor(which);

      container.innerHTML = `
        <div class="table-container">
          <table class="equipment-table">
            <thead>
              <tr>
                ${headers.map(h => `<th>${h}</th>`).join('')}
              </tr>
            </thead>
            <tbody id="${prefix}TableBody"></tbody>
          </table>
          <div class="pagination">
            <button id="${prefix}PrevBtn">Previous</button>
            <span class="page-info" id="${prefix}PageInfo">Page 1 of ${totalPages}</span>
            <button id="${prefix}NextBtn">Next</button>
          </div>
        </div>
      `;

      const tbody = document.getElementById(`${prefix}TableBody`);
      const prevBtn = document.getElementById(`${prefix}PrevBtn`);
      const nextBtn = document.getElementById(`${prefix}NextBtn`);
      const pageInfo = document.getElementById(`${prefix}PageInfo`);

      function renderPage(page) {
        tbody.innerHTML = '';
        const start = (page - 1) * pageSize;
        const end = Math.min(start + pageSize, data.length);

        for (let i = start; i < end; i++) {
          const item = data[i];
          const tr = document.createElement('tr');

          headers.forEach(key => {
            const td = document.createElement('td');
            td.textContent = safeText(item[key]);
            td.contentEditable = true;
            td.addEventListener('input', () => {
              item[key] = td.textContent.trim();
            });
            tr.appendChild(td);
          });

          tbody.appendChild(tr);
        }

        prevBtn.disabled = page === 1;
        nextBtn.disabled = page === totalPages;
        pageInfo.textContent = `Page ${page} of ${totalPages}`;
      }

      prevBtn.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          renderPage(currentPage);
        }
      });

      nextBtn.addEventListener('click', () => {
        if (currentPage < totalPages) {
          currentPage++;
          renderPage(currentPage);
        }
      });

      renderPage(1);
    }

    // ===== Excel download buttons (KEEP UI button, change behavior to match old backend) =====
    // Existing buttons call these by onclick in HTML.
    async function downloadMvExcel() {
      await downloadEditedExcelFromBackend(mvData, "type2");
    }

    async function downloadEdExcel() {
      await downloadEditedExcelFromBackend(edData, "type1");
    }

    async function downloadEditedExcelFromBackend(state, which) {
      if (!state || !Array.isArray(state.equipment_data) || state.equipment_data.length === 0) return;

      const headers = headersFor(which);
      const payload = {
        which,
        rows: state.equipment_data.map(r => {
          const obj = {};
          headers.forEach(h => obj[h] = safeText(r[h]));
          return obj;
        })
      };

      try {
        const res = await fetch(absUrl(ENDPOINTS.exportEdited), {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const text = await res.text();
          throw new Error(`Export failed: ${res.status}
${text || ''}`);
        }

        const json = await res.json();
        if (!json.excel_file_name) throw new Error("Server did not return excel_file_name.");

        window.open(absUrl(ENDPOINTS.outputsPrefix + json.excel_file_name), "_blank");
      } catch (e) {
        alert(safeText(e.message || e));
      }
    }
  </script>
</body>
</html>
